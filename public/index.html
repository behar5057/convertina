<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertina - Working File Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #ffb6c1 0%, #dda0dd 100%); color: #333; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .container { width: 100%; max-width: 900px; background-color: rgba(255, 255, 255, 0.95); border-radius: 20px; box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1); overflow: hidden; }
        header { background: linear-gradient(to right, #fb7185, #a78bfa); color: white; padding: 30px; text-align: center; }
        h1 { font-size: 2.5rem; margin-bottom: 10px; font-weight: 700; }
        .content { padding: 30px; }
        .upload-area { border: 2px dashed #fb7185; border-radius: 15px; padding: 40px; text-align: center; margin-bottom: 25px; background: #fdf2f8; cursor: pointer; transition: all 0.3s ease; }
        .upload-area:hover { background: #fce7f3; border-color: #ec4899; }
        .conversion-options { display: none; background: #f8fafc; padding: 25px; border-radius: 15px; margin-bottom: 20px; }
        .format-selection { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .format-option { background: white; border: 2px solid #e2e8f0; border-radius: 10px; padding: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; }
        .format-option.selected { border-color: #fb7185; background: #fdf2f8; }
        .btn { background: linear-gradient(to right, #fb7185, #a78bfa); color: white; border: none; padding: 12px 30px; font-size: 1rem; border-radius: 30px; cursor: pointer; transition: all 0.3s ease; }
        .download-btn { background: linear-gradient(to right, #10b981, #34d399); display: none; text-decoration: none; }
        .success-message { background: #d1fae5; color: #065f46; padding: 15px; border-radius: 10px; margin-top: 15px; display: none; text-align: center; }
        .preview-image { max-width: 300px; max-height: 200px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .progress-bar { height: 10px; background-color: #e0e0e0; border-radius: 5px; overflow: hidden; margin-bottom: 10px; }
        .progress { height: 100%; background: linear-gradient(to right, #fb7185, #a78bfa); width: 0%; transition: width 0.3s ease; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üå∏ Convertina</h1>
            <div class="subtitle">WORKING File Conversion Platform</div>
        </header>
        
        <div class="content">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÅ</div>
                <h3>Drag & Drop Your Image</h3>
                <p>or click to browse</p>
                <input type="file" id="fileInput" style="display: none;" accept="image/*">
            </div>
            
            <div class="file-info" id="fileInfo" style="display: none;">
                <strong>Selected File:</strong> <span id="fileName"></span> ‚Ä¢ <span id="fileSize"></span>
            </div>

            <div class="preview-area" id="previewArea" style="display: none; text-align: center; margin: 20px 0;">
                <h4>Preview:</h4>
                <img id="previewImage" class="preview-image" src="" alt="Preview">
            </div>
            
            <div class="conversion-options" id="conversionOptions">
                <h3 style="text-align: center; margin-bottom: 20px; color: #fb7185;">Choose Output Format</h3>
                <div class="format-selection">
                    <div class="format-option" data-format="png">üñºÔ∏è PNG</div>
                    <div class="format-option" data-format="jpg">üì∑ JPG</div>
                    <div class="format-option" data-format="pdf">üìÑ PDF</div>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                <button id="convertButton" class="btn" disabled>Convert File</button>
                <a id="downloadButton" class="btn download-btn" download>Download</a>
            </div>
            
            <div class="progress-container" id="progressContainer" style="display: none; margin-top: 20px;">
                <div class="progress-bar">
                    <div class="progress" id="progressBar"></div>
                </div>
                <div id="progressText" style="text-align: center;">Processing...</div>
            </div>

            <div class="success-message" id="successMessage">
                ‚úÖ File converted successfully! Click the download button.
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const previewArea = document.getElementById('previewArea');
            const previewImage = document.getElementById('previewImage');
            const conversionOptions = document.getElementById('conversionOptions');
            const convertButton = document.getElementById('convertButton');
            const downloadButton = document.getElementById('downloadButton');
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const formatOptions = document.querySelectorAll('.format-option');
            const successMessage = document.getElementById('successMessage');
            
            let selectedFile = null;
            let selectedFormat = null;

            // File handling
            uploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);

            function handleFileSelect(e) {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    selectedFile = file;
                    
                    // Show file info
                    fileName.textContent = file.name;
                    fileSize.textContent = formatFileSize(file.size);
                    fileInfo.style.display = 'block';
                    
                    // Show preview
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImage.src = e.target.result;
                        previewArea.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                    
                    // Update UI
                    uploadArea.innerHTML = '<div style="color: #fb7185; font-size: 3rem;">‚úÖ</div><h3>File Ready!</h3>';
                    conversionOptions.style.display = 'block';
                    
                    // Reset
                    formatOptions.forEach(opt => opt.classList.remove('selected'));
                    selectedFormat = null;
                    convertButton.disabled = true;
                    downloadButton.style.display = 'none';
                }
            }

            // Format selection
            formatOptions.forEach(option => {
                option.addEventListener('click', () => {
                    formatOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    selectedFormat = option.dataset.format;
                    convertButton.disabled = false;
                });
            });

            // REAL WORKING CONVERSION
            convertButton.addEventListener('click', async function() {
                if (!selectedFile || !selectedFormat) return;
                
                convertButton.disabled = true;
                progressContainer.style.display = 'block';
                progressBar.style.width = '0%';
                downloadButton.style.display = 'none';
                successMessage.style.display = 'none';
                
                try {
                    const fileReader = new FileReader();
                    fileReader.onload = async function(e) {
                        // Simulate progress
                        progressBar.style.width = '30%';
                        progressText.textContent = "Processing image...";
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                        progressBar.style.width = '60%';
                        progressText.textContent = "Creating output...";
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                        progressBar.style.width = '90%';
                        progressText.textContent = "Finalizing...";
                        
                        // Perform actual conversion
                        const result = await convertFile(e.target.result, selectedFormat, selectedFile.name);
                        
                        progressBar.style.width = '100%';
                        progressText.textContent = "Complete!";
                        
                        // Setup download
                        const url = URL.createObjectURL(result.blob);
                        downloadButton.href = url;
                        downloadButton.download = result.filename;
                        downloadButton.textContent = `Download ${result.filename}`;
                        downloadButton.style.display = 'inline-block';
                        successMessage.style.display = 'block';
                        convertButton.disabled = false;
                        
                        setTimeout(() => progressContainer.style.display = 'none', 2000);
                    };
                    fileReader.readAsDataURL(selectedFile);
                    
                } catch (error) {
                    alert('Conversion failed: ' + error);
                    convertButton.disabled = false;
                    progressContainer.style.display = 'none';
                }
            });

            // REAL CONVERSION FUNCTION
            async function convertFile(fileData, format, originalName) {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = function() {
                        if (format === 'pdf') {
                            // USE jspdf for REAL PDF generation
                            const { jsPDF } = window.jspdf;
                            const pdf = new jsPDF();
                            
                            const pageWidth = pdf.internal.pageSize.getWidth();
                            const pageHeight = pdf.internal.pageSize.getHeight();
                            
                            // Calculate image dimensions
                            const imgWidth = img.width;
                            const imgHeight = img.height;
                            const ratio = Math.min(pageWidth / imgWidth, pageHeight / imgHeight) * 0.8;
                            
                            const width = imgWidth * ratio;
                            const height = imgHeight * ratio;
                            const x = (pageWidth - width) / 2;
                            const y = (pageHeight - height) / 2;
                            
                            // Add image to PDF
                            pdf.addImage(fileData, 'JPEG', x, y, width, height);
                            
                            // Add simple text
                            pdf.setFontSize(12);
                            pdf.text('Converted with Convertina', 20, 20);
                            
                            const pdfBlob = pdf.output('blob');
                            resolve({
                                blob: pdfBlob,
                                filename: `${originalName.split('.')[0]}.pdf`
                            });
                            
                        } else if (format === 'png' || format === 'jpg') {
                            // Image to image conversion
                            const canvas = document.createElement('canvas');
                            canvas.width = img.width;
                            canvas.height = img.height;
                            const ctx = canvas.getContext('2d');
                            
                            if (format === 'jpg') {
                                ctx.fillStyle = 'white';
                                ctx.fillRect(0, 0, canvas.width, canvas.height);
                            }
                            
                            ctx.drawImage(img, 0, 0);
                            
                            canvas.toBlob(function(blob) {
                                resolve({
                                    blob: blob,
                                    filename: `${originalName.split('.')[0]}.${format}`
                                });
                            }, format === 'jpg' ? 'image/jpeg' : 'image/png', 0.9);
                        }
                    };
                    img.src = fileData;
                });
            }

            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        });
    </script>
</body>
</html>
